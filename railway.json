{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE"
  },
  "deploy": {
    "startCommand": "set -e; php -S 0.0.0.0:$PORT -t public public/index.php & SERVER_PID=$!; php artisan optimize:clear || true; php artisan config:cache || true; if [ \"$SKIP_AUTO_MIGRATE\" != \"true\" ]; then RETRIES=${MIGRATE_RETRIES:-10}; SLEEP=${MIGRATE_SLEEP:-5}; i=1; while [ \"$i\" -le \"$RETRIES\" ]; do php artisan migrate --force && break || true; echo \"Migration attempt $i failed; retrying in $SLEEP seconds...\"; sleep \"$SLEEP\"; i=$((i+1)); done; fi; php artisan storage:link || true; wait \"$SERVER_PID\"",
    "healthcheckPath": "/robots.txt",
    "healthcheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
